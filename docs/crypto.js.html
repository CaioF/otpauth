<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: crypto.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: crypto.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// eslint-disable-next-line import/no-extraneous-dependencies
import sjcl from 'sjcl'; // SJCL is included during compilation.

import { InternalUtils } from './utils';

/**
 * An object containing some cryptography functions
 * with dirty workarounds for Node.js and browsers.
 * @private
 * @namespace Crypto
 * @type {Object}
 */
export const Crypto = {};

/**
 * Returns random bytes.
 * @memberof Crypto
 * @method randomBytes
 * @param {number} size Size.
 * @returns {ArrayBuffer} Random bytes.
 */
Crypto.randomBytes = undefined;

/**
 * Calculates an HMAC digest.
 * In Node.js, the command `openssl list -digest-algorithms` displays the available digest algorithms.
 * @memberof Crypto
 * @method hmacDigest
 * @param {string} algorithm Algorithm.
 * @param {ArrayBuffer} key Key.
 * @param {ArrayBuffer} message Message.
 * @returns {ArrayBuffer} Digest.
 */
Crypto.hmacDigest = undefined;

if (InternalUtils.isNode) {
	const NodeBuffer = InternalUtils.globalThis.Buffer;
	const NodeCrypto = InternalUtils.require('crypto');

	let nodeBufferFromArrayBuffer;
	if (typeof NodeBuffer.from === 'function') {
		nodeBufferFromArrayBuffer = NodeBuffer.from;
	} else {
		// Node.js &lt; 5.10.0
		nodeBufferFromArrayBuffer = arrayBuffer => {
			const nodeBuffer = new NodeBuffer(arrayBuffer.byteLength);
			const uint8Array = new Uint8Array(arrayBuffer);
			for (let i = 0; i &lt; uint8Array.length; i++) {
				nodeBuffer[i] = uint8Array[i];
			}
			return nodeBuffer;
		};
	}

	let nodeBufferToArrayBuffer;
	if (NodeBuffer.prototype instanceof Uint8Array) {
		nodeBufferToArrayBuffer = nodeBuffer => nodeBuffer.buffer;
	} else {
		// Node.js &lt; 4.0.0
		nodeBufferToArrayBuffer = nodeBuffer => {
			const uint8Array = new Uint8Array(nodeBuffer.length);
			for (let i = 0; i &lt; uint8Array.length; i++) {
				uint8Array[i] = nodeBuffer[i];
			}
			return uint8Array.buffer;
		};
	}

	Crypto.randomBytes = size => {
		const randomBytes = NodeCrypto.randomBytes(size);
		return nodeBufferToArrayBuffer(randomBytes);
	};

	Crypto.hmacDigest = (algorithm, key, message) => {
		const hmac = NodeCrypto.createHmac(algorithm, nodeBufferFromArrayBuffer(key));
		hmac.update(nodeBufferFromArrayBuffer(message));
		return nodeBufferToArrayBuffer(hmac.digest());
	};
} else {
	const BrowserCrypto = InternalUtils.globalThis.crypto || InternalUtils.globalThis.msCrypto;

	let getRandomValues;
	if (typeof BrowserCrypto !== 'undefined' &amp;&amp; typeof BrowserCrypto.getRandomValues === 'function') {
		getRandomValues = array => {
			BrowserCrypto.getRandomValues(array);
		};
	} else {
		InternalUtils.console.warn('Cryptography API not available, falling back to \'Math.random\'...');
		getRandomValues = array => {
			for (let i = 0; i &lt; array.length; i++) {
				array[i] = Math.floor(Math.random() * 256);
			}
		};
	}

	Crypto.randomBytes = size => {
		const randomBytes = new Uint8Array(size);
		getRandomValues(randomBytes);
		return randomBytes.buffer;
	};

	Crypto.hmacDigest = (algorithm, key, message) => {
		const hash = sjcl.hash[algorithm.toLowerCase()];
		if (typeof hash === 'undefined') {
			throw new TypeError('Unknown hash function');
		}
		// eslint-disable-next-line new-cap
		const hmac = new sjcl.misc.hmac(sjcl.codec.arrayBuffer.toBits(key), hash);
		hmac.update(sjcl.codec.arrayBuffer.toBits(message));
		return sjcl.codec.arrayBuffer.fromBits(hmac.digest(), false);
	};
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-OTPAuth.html">OTPAuth</a></li></ul><h3>Namespaces</h3><ul><li><a href="Utils.html">Utils</a></li><li><a href="Utils.b32.html">b32</a></li><li><a href="Utils.hex.html">hex</a></li><li><a href="Utils.raw.html">raw</a></li><li><a href="Utils.uint.html">uint</a></li></ul><h3>Classes</h3><ul><li><a href="HOTP.html">HOTP</a></li><li><a href="Secret.html">Secret</a></li><li><a href="TOTP.html">TOTP</a></li><li><a href="URI.html">URI</a></li></ul><h3>Global</h3><ul><li><a href="global.html#version">version</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sun Aug 11 2019 19:02:27 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
